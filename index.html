<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" const="text/html;charset=UTF-8" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <title>Online Chat</title>
</head>

<style>
  body{
    margin-top: 20px;
  }
.card{
  border: dotted black;
  width: 500px;
  background: linear-gradient(to bottom, #ffffff 0%, #ffcccc 100%);
  margin-top: 0%;
}
.form-control{
  width:300px;
}
img{
  width: 200px;
  height: 150px;
}


</style>

<body>
  <center>
  <div class="card">
    <img src="http://www.starwebmaker.com/images/chating.png">
    <hr>
    <div id="change_username" class="form-group">
      <input id="username" type="text" class="form-control" />
      <br>
      <button id="btnUsername" class="btn btn-outline-primary" type="button">USERNAME</button>
    </div>
    <br>
    <br>
    <section id="input_zone">
      <input id="message" class="form-control" type="text" />
      <br>
      <button id="btnMessage" class="btn btn-outline-danger" type="button">SEND</button>
      <br>
      <br>
    </section>
  </div>
  </center>
  </div>
  <br>
  <center>
    <div class="card">
      <header>
        <h1>Message Box</h1>
      </header>

      <section id="messagebox">
        <hr>
        <section id="feedback"></section>
      </section>
    </div>
  </center>

  <script src="http://code.jquery.com/jquery-latest.min.js"></script>

  <script>
    $(function () {
      var socket = io.connect('http://localhost:8080')

      var message = $("#message")
      var username = $("#username")
      var btnMessage = $("#btnMessage")
      var btnUsername = $("#btnUsername")
      var messagebox = $("#messagebox")
      var feedback = $("#feedback")

      //creating message
      btnMessage.click(function () {
        socket.emit('new_message', {
          message: message.val()
        })
      })

      //appending a new_message
      socket.on("new_message", (data) => {
        feedback.html('');
        message.val('');
        messagebox.append("<p class='message'>" + data.username + ": " + data.message + "</p>")
      })

      //changing a username
      btnUsername.click(function () {
        socket.emit('change_username', {
          username: username.val()
        })
      });

      //Emit typing
      message.bind("keypress", () => {
        socket.emit('typing')
      })

      //typing
      socket.on('typing', (data) => {
        feedback.html("<p><i>" + data.username + " is typing a message..." + "</i></p>")
      })
    });
  </script>
</body>

</html>